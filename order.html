<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Place Order | Efoyta Tech</title>
  <link rel="icon" type="image/png" href="img/favi.png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet" />

  <style>
    /* ================= GLOBAL & NAVBAR STYLES ================= */
    :root {
      --primary: #2d5bff;
      --dark-nav: rgba(15, 23, 42, 0.95);
      --dark: #0f172a;
      --bg: #f8fafc;
      --text: #334155;
      --border: #e2e8f0;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    body { background-color: var(--bg); color: var(--text); }

    .navbar {
      position: fixed; top: 0; left: 0; width: 100%;
      display: flex; align-items: center; justify-content: space-between;
      padding: 15px 10%; background: var(--dark-nav);
      backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      z-index: 1000;
    }
    .logo { font-size: 1.6rem; font-weight: 800; color: #fff; text-decoration: none; }
    .logo span { color: var(--primary); }
    
    .nav_items { display: flex; list-style: none; gap: 30px; align-items: center; }
    .nav_items li a { text-decoration: none; color: rgba(255, 255, 255, 0.85); font-weight: 500; transition: 0.3s; }
    .nav_items li a:hover, .nav_items li a.active { color: var(--primary); }
    
    /* Profile Container */
    .profile-container { position: relative; margin-left: 20px; }
    .profile-trigger { 
      background: rgba(255, 255, 255, 0.1); padding: 8px 15px; border-radius: 50px;
      color: white; cursor: pointer; display: flex; align-items: center; gap: 8px;
      border: 1px solid rgba(255,255,255,0.1); transition: 0.3s;
    }
    .profile-dropdown {
      position: absolute; top: 120%; right: 0; width: 220px;
      background: white; border-radius: 12px; padding: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      display: none; flex-direction: column; z-index: 1001;
    }
    .profile-dropdown.show { display: flex; }
    .profile-dropdown a { text-decoration: none; color: #333; padding: 10px; font-size: 0.9rem; border-radius: 6px; display: flex; align-items: center; gap: 10px; }
    .profile-dropdown a:hover { background: #f0f4ff; color: var(--primary); }

    /* ================= ORDER FORM STYLES ================= */
    .sec { padding: 120px 5% 60px; max-width: 900px; margin: auto; }
    .head_1 { text-align: center; margin-bottom: 40px; }
    .sub_heading { color: var(--primary); font-size: 1.2rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
    .heading { font-size: 2.5rem; font-weight: 700; color: var(--dark); }

    .order_container {
      background: #fff; padding: 40px; border-radius: 24px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.05); border: 1px solid var(--border);
    }

    .order_form { display: flex; flex-direction: column; gap: 1.5rem; }
    .order_form label { font-weight: 600; color: var(--dark); font-size: 0.9rem; }

    .order_form input, .order_form select, .order_form textarea {
      padding: 12px 18px; border-radius: 12px; border: 1px solid var(--border);
      font-size: 1rem; width: 100%; transition: 0.3s;
    }
    .order_form input:focus { border-color: var(--primary); outline: none; background: #fcfdff; }

    .btn {
      padding: 14px 28px; border: none; border-radius: 12px;
      background: var(--primary); color: #fff; font-weight: 600; cursor: pointer;
      transition: 0.3s; text-align: center;
    }
    .btn:hover { background: #1a46e6; transform: translateY(-2px); box-shadow: 0 8px 20px rgba(45, 91, 255, 0.3); }

    .products_box {
      background: #f1f5f9; padding: 15px; border-radius: 12px;
      max-height: 250px; overflow-y: auto; margin-top: 10px;
    }
    .product_row {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 8px; padding: 12px; border-radius: 10px; background: #fff;
      border: 1px solid var(--border);
    }
    .remove { background: #fee2e2; color: #ef4444; border: none; border-radius: 8px; padding: 5px 12px; cursor: pointer; font-size: 0.8rem; }

    .order_summary { background: var(--dark); padding: 20px; border-radius: 12px; color: white; display: flex; justify-content: space-between; align-items: center; }
    .order_summary h4 span { color: var(--primary); font-size: 1.4rem; }

    /* ================= FOOTER STYLES ================= */
    .unified-footer { background: #0f172a; color: #94a3b8; padding: 4rem 10% 2rem; }
    .footer-grid { display: flex; flex-wrap: wrap; gap: 4rem; border-bottom: 1px solid #1e293b; padding-bottom: 3rem; }
    .footer-col { flex: 1; min-width: 250px; }
    .footer-col h4 { color: white; margin-bottom: 1.5rem; }
    .footer-col a { color: #94a3b8; text-decoration: none; display: block; margin-bottom: 10px; font-size: 0.9rem; }
    .footer-col a:hover { color: var(--primary); }

    @media(max-width: 768px) {
      .nav_items { display: none; position: absolute; top: 100%; left: 0; width: 100%; background: var(--dark-nav); flex-direction: column; padding: 20px; }
      .nav_items.active { display: flex; }
      .menu-toggle { display: block !important; color: white; font-size: 1.5rem; cursor: pointer; margin-left: 15px; }
      .heading { font-size: 1.8rem; }
    }
  </style>
</head>

<body>

<header>
  <nav class="navbar">
    <a href="index.html" class="logo">Efoyta <span>Tech</span></a>
    
    <div style="display: flex; align-items: center;">
      <ul class="nav_items" id="nav-list">
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="order.html" class="active">New Order</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>

      <div class="profile-container">
        <div class="profile-trigger" id="profileTrigger">
          <i class="ri-user-3-line"></i> Account
        </div>
        <div class="profile-dropdown" id="profileMenu">
          <a href="user.html"><i class="ri-dashboard-line"></i> Dashboard</a>
          <a href="#" id="logoutBtn" style="color: #ef4444;"><i class="ri-logout-box-r-line"></i> Logout</a>
        </div>
      </div>

      <div class="menu-toggle" id="mobile-menu" style="display: none;">
        <i class="ri-menu-line"></i>
      </div>
    </div>
  </nav>
</header>

<section class="sec">
  <div class="head_1">
    <h3 class="sub_heading">Start a project</h3>
    <h1 class="heading">Customize Your Order</h1>
    <p>Upload your design and payment receipt to begin.</p>
  </div>

  <div class="order_container">
    <form class="order_form" id="orderForm">
      <div>
        <label>Select Product</label>
        <select id="material" style="margin-top: 8px;">
          <option value="">Choose Product...</option>
          <optgroup label="Paper Bags (Duplex)">
            <option data-price="35">Small – 35 ETB</option>
            <option data-price="45">Medium – 45 ETB</option>
            <option data-price="60">Large – 60 ETB</option>
          </optgroup>
          <optgroup label="Clothing & Merch">
            <option data-price="80">T-Shirt - 80 ETB</option>
            <option data-price="120">Hoodie - 120 ETB</option>
            <option data-price="90">Mugs - 90 ETB</option>
          </optgroup>
        </select>
      </div>

      <div style="display: flex; gap: 15px; align-items: flex-end;">
        <div style="flex: 1;">
          <label>Quantity</label>
          <input type="number" id="quantity" min="1" value="1" style="margin-top: 8px;">
        </div>
        <button type="button" class="btn" onclick="addProduct()" style="height: 50px;">Add</button>
      </div>

      <div class="products_box" id="productsBox">
        <p style="text-align: center; color: #94a3b8; font-size: 0.85rem;">No products added yet.</p>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div>
          <label>Design File (Logo)</label>
          <input type="file" id="logo" required style="margin-top: 8px;">
        </div>
        <div>
          <label>Payment Receipt</label>
          <input type="file" id="receipt" required style="margin-top: 8px;">
        </div>
      </div>

      <div style="background:#f0f7ff; padding: 15px; border-radius: 12px; border: 1px dashed var(--primary); font-size: 0.85rem;">
        <p><strong>Payment Account (Telebirr):</strong> +251 90 799 2963</p>
        <p><strong>CBE:</strong> 1000123456789 (Efoyta Tech)</p>
      </div>

      <label>Full Name</label>
      <input type="text" id="name" required placeholder="Enter your full name">

      <label>Contact Email</label>
      <input type="email" id="email" required placeholder="Enter your email">

      <label>Phone Number</label>
      <input type="tel" id="phone" required placeholder="+251...">

      <div class="order_summary">
        <p>Total Amount</p>
        <h4><span id="totalPrice">0</span> ETB</h4>
      </div>

      <button class="btn" type="submit" id="submitBtn">Place Order Now</button>
    </form>
  </div>
</section>

<footer class="unified-footer">
  <div class="footer-grid">
    <div class="footer-col">
      <h4 style="color: var(--primary);">Efoyta Tech</h4>
      <p>The standard for digital printing in Ethiopia. High quality, zero hassle printing for your brand.</p>
    </div>
    <div class="footer-col">
      <h4>Navigation</h4>
      <a href="index.html">Home</a>
      <a href="about.html">About Us</a>
      <a href="contact.html">Contact Us</a>
    </div>
    <div class="footer-col">
      <h4>Support</h4>
      <p>+251 90 799 2963</p>
      <p>Addis Ababa, Ethiopia</p>
    </div>
  </div>
  <p style="text-align: center; margin-top: 3rem; font-size: 0.8rem;">© 2025 Efoyta Print Solutions.</p>
</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";
  import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBHcGnd6tDNg5Wruabo8sWXO_Xz-SOrPBI",
    authDomain: "ordering-fd42a.firebaseapp.com",
    databaseURL: "https://ordering-fd42a-default-rtdb.firebaseio.com/",
    projectId: "ordering-fd42a",
    messagingSenderId: "379564875478",
    appId: "1:379564875478:web:42bc00e70a594bc24ef377"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  // --- MENU LOGIC ---
  const menuBtn = document.getElementById('mobile-menu');
  const navList = document.getElementById('nav-list');
  const profileTrigger = document.getElementById('profileTrigger');
  const profileMenu = document.getElementById('profileMenu');

  menuBtn.onclick = () => navList.classList.toggle('active');
  profileTrigger.onclick = (e) => { e.stopPropagation(); profileMenu.classList.toggle('show'); };
  document.onclick = () => profileMenu.classList.remove('show');

  // --- ORDER LOGIC ---
  const products = [];
  const box = document.getElementById("productsBox");
  const totalEl = document.getElementById("totalPrice");

  window.addProduct = () => {
    const material = document.getElementById("material");
    const quantity = document.getElementById("quantity");
    const sel = material.options[material.selectedIndex];
    const qty = parseInt(quantity.value);

    if (!sel.dataset.price || qty < 1) return alert("Select product and quantity!");

    products.push({ name: sel.textContent, price: Number(sel.dataset.price), qty });
    renderProducts();
  };

  function renderProducts() {
    box.innerHTML = products.length ? "" : '<p style="text-align: center; color: #94a3b8;">No products added.</p>';
    let total = 0;
    products.forEach((p, i) => {
      total += p.price * p.qty;
      const div = document.createElement("div");
      div.className = "product_row";
      div.innerHTML = `<span>${p.qty}x ${p.name}</span><strong>${p.price * p.qty} ETB</strong>`;
      const del = document.createElement("button");
      del.className = "remove"; del.textContent = "Remove";
      del.onclick = () => { products.splice(i, 1); renderProducts(); };
      div.appendChild(del); box.appendChild(div);
    });
    totalEl.textContent = total;
  }

  async function uploadToCloudinary(file) {
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", "efoyta_upload");
    const res = await fetch("https://api.cloudinary.com/v1_1/ddbn2w991/image/upload", { method: "POST", body: formData });
    const data = await res.json();
    return data.secure_url;
  }

  document.getElementById("orderForm").onsubmit = async (e) => {
    e.preventDefault();
    const btn = document.getElementById("submitBtn");
    if (!products.length) return alert("Add a product first!");

    btn.disabled = true; btn.textContent = "Uploading Files...";
    
    try {
      const logoURL = await uploadToCloudinary(document.getElementById("logo").files[0]);
      const receiptURL = await uploadToCloudinary(document.getElementById("receipt").files[0]);

      await push(ref(db, "orders"), {
        products, totalETB: totalEl.textContent,
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        phone: document.getElementById("phone").value,
        logoURL, receiptURL, status: "Pending",
        time: new Date().toISOString()
      });

      alert("Order Placed Successfully!");
      window.location.href = "user.html";
    } catch (err) {
      alert("Error placing order. Try again.");
      btn.disabled = false; btn.textContent = "Place Order Now";
    }
  };

  document.getElementById("logoutBtn").onclick = () => signOut(auth).then(() => window.location.href="login.html");
</script>
</body>
</html>