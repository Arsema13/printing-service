<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Dashboard | Efoyta Tech</title>
   <link rel="icon" type="image/png" href="img/favi.png">
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet" />

  <style>
    /* ================= GLOBAL & DASHBOARD SPECIFIC ================= */
    :root {
      --primary: #2d5bff;
      --dark-nav: rgba(15, 23, 42, 0.95);
      --dark: #0f172a;
      --bg: #f8fafc;
      --text: #334155;
      --border: #e2e8f0;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    body { background-color: var(--bg); color: var(--text); }

    /* Modern Navbar (Contact Page Style) */
    .navbar {
      position: fixed; top: 0; left: 0; width: 100%;
      display: flex; align-items: center; justify-content: space-between;
      padding: 15px 10%; background: var(--dark-nav);
      backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      z-index: 1000;
    }
    .logo { font-size: 1.6rem; font-weight: 800; color: #fff; text-decoration: none; }
    .logo span { color: var(--primary); }
    
    .nav_items { display: flex; list-style: none; gap: 30px; align-items: center; }
    .nav_items li a { text-decoration: none; color: rgba(255, 255, 255, 0.85); font-weight: 500; transition: 0.3s; }
    .nav_items li a:hover { color: var(--primary); }
    
    /* Profile Container */
    .profile-container { position: relative; margin-left: 20px; }
    .profile-trigger { 
      background: rgba(255, 255, 255, 0.1); padding: 8px 15px; border-radius: 50px;
      color: white; cursor: pointer; display: flex; align-items: center; gap: 8px;
      border: 1px solid rgba(255,255,255,0.1); transition: 0.3s;
    }
    .profile-dropdown {
      position: absolute; top: 120%; right: 0; width: 220px;
      background: white; border-radius: 12px; padding: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      display: none; flex-direction: column; z-index: 1001;
    }
    .profile-dropdown.show { display: flex; }
    .profile-dropdown .email-tag { font-size: 0.75rem; color: #64748b; padding: 5px 10px; border-bottom: 1px solid #eee; margin-bottom: 5px; word-break: break-all; }
    .profile-dropdown a { text-decoration: none; color: #333; padding: 10px; font-size: 0.9rem; border-radius: 6px; display: flex; align-items: center; gap: 10px; transition: 0.2s; }
    .profile-dropdown a:hover { background: #f0f4ff; color: var(--primary); }
    .profile-dropdown a.logout { color: #ef4444; }

    /* Dashboard Content */
    .dashboard-container { max-width: 1000px; margin: 120px auto 40px; padding: 0 20px; min-height: 60vh; }

    .welcome-card {
      background: linear-gradient(135deg, var(--dark) 0%, #1e293b 100%);
      padding: 40px; border-radius: 24px; color: white; margin-bottom: 30px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .welcome-text h1 { font-size: 2rem; margin-bottom: 5px; }

    .stats-bar { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; }
    .stat-box { background: white; padding: 25px; border-radius: 16px; border: 1px solid var(--border); text-align: center; }
    
    .order-card {
      background: white; padding: 20px; border-radius: 16px; margin-bottom: 15px;
      display: flex; justify-content: space-between; align-items: center;
      border: 1px solid var(--border); transition: 0.3s;
    }
    
    .status-badge { padding: 6px 16px; border-radius: 50px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; }
    .status-pending { background: #fff7ed; color: #c2410c; }
    .status-finished { background: #f0fdf4; color: #15803d; }

    /* Unified Footer Styles */
    .unified-footer { background: #0f172a; color: #94a3b8; padding: 4rem 10% 2rem; font-family: 'Poppins', sans-serif; }
    .footer-grid { display: flex; flex-wrap: wrap; gap: 4rem; border-bottom: 1px solid #1e293b; padding-bottom: 3rem; }
    .footer-col { flex: 1; min-width: 250px; }
    .footer-col h4 { color: white; margin-bottom: 1.5rem; }
    .footer-col ul { list-style: none; padding: 0; }
    .footer-col a { color: #94a3b8; text-decoration: none; display: block; margin-bottom: 10px; font-size: 0.9rem; transition: 0.3s; }
    .footer-col a:hover { color: var(--primary); }
    .footer-socials { display: flex; gap: 15px; margin-top: 1rem; }
    .footer-socials a { color: white; background: #1e293b; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; transition: 0.3s; }

    @media (max-width: 768px) {
      .nav_items { 
        display: none; position: absolute; top: 100%; left: 0; width: 100%; 
        background: var(--dark-nav); flex-direction: column; padding: 20px; 
      }
      .nav_items.active { display: flex; }
      .menu-toggle { display: block !important; color: white; font-size: 1.5rem; cursor: pointer; }
      .welcome-card { flex-direction: column; text-align: center; gap: 20px; }
    }
  </style>
</head>
<body>

<header>
  <nav class="navbar">
    <a href="index.html" class="logo">Efoyta <span>Tech</span></a>
    
    <div style="display: flex; align-items: center;">
      <ul class="nav_items" id="nav-list">
        <li><a href="profile.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="order.html">New Order</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>

      <div class="profile-container">
        <div class="profile-trigger" id="profileTrigger">
          <i class="ri-user-3-line"></i> Account <i class="ri-arrow-down-s-line"></i>
        </div>
        <div class="profile-dropdown" id="profileMenu">
          <p class="email-tag" id="dropdownEmail">loading...</p>
          <a href="#"><i class="ri-settings-3-line"></i> Settings</a>
          <a href="#" class="logout" id="logoutLink"><i class="ri-logout-box-r-line"></i> Logout</a>
        </div>
      </div>

      <div class="menu-toggle" id="mobile-menu" style="margin-left: 15px; display: none;">
        <i class="ri-menu-line"></i>
      </div>
    </div>
  </nav>
</header>

<main class="dashboard-container">
  <div class="welcome-card">
    <div class="welcome-text">
      <h1>Hello, <span id="displayUserName">User</span>!</h1>
      <p>Welcome back to your Efoyta Tech dashboard.</p>
    </div>
    <div class="welcome-icon">
      <i class="ri-dashboard-3-line" style="font-size: 4rem; opacity: 0.2;"></i>
    </div>
  </div>

  <div class="stats-bar">
    <div class="stat-box">
      <h3 id="orderCount">0</h3>
      <p>Total Orders</p>
    </div>
    <div class="stat-box">
      <h3 id="userStatusText">Active</h3>
      <p>Account Status</p>
    </div>
  </div>

  <h2 class="section-title" style="margin-bottom: 20px;"><i class="ri-list-check-3"></i> Recent Orders</h2>
  <div id="ordersList">
    <p style="text-align: center; padding: 20px; color: #94a3b8;">Scanning for orders...</p>
  </div>
</main>

<footer class="unified-footer">
  <div class="footer-grid">
    <div class="footer-col">
      <h4 style="color: var(--primary);">Efoyta Tech</h4>
      <p>The standard for digital printing in Ethiopia. High quality, zero hassle printing for your brand.</p>
      <div class="footer-socials">
        <a href="https://t.me/Lilyteoes" target="_blank"><i class="ri-telegram-line"></i></a>
        <a href="#"><i class="ri-tiktok-line"></i></a>
        <a href="mailto:eliyasminase123@gmail.com"><i class="ri-mail-line"></i></a>
      </div>
    </div>
    <div class="footer-col">
      <h4>Navigation</h4>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About Us</a></li>
        <li><a href="contact.html">Contact Us</a></li>
        <li><a href="privacy.html">Privacy Policy</a></li>
        <li><a href="term.html">Terms & Conditions</a></li>
      </ul>
    </div>
    <div class="footer-col">
      <h4>Reach Us</h4>
      <p><i class="ri-phone-fill"></i> +251 90 799 2963</p>
      <p><i class="ri-map-pin-2-fill"></i> Addis Ababa, Ethiopia</p>
    </div>
  </div>
  <p style="text-align: center; margin-top: 3rem; font-size: 0.8rem;">Â© 2025 Efoyta Print Solutions. All Rights Reserved.</p>
</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBHcGnd6tDNg5Wruabo8sWXO_Xz-SOrPBI",
    authDomain: "ordering-fd42a.firebaseapp.com",
    databaseURL: "https://ordering-fd42a-default-rtdb.firebaseio.com/",
    projectId: "ordering-fd42a",
    messagingSenderId: "379564875478",
    appId: "1:379564875478:web:42bc00e70a594bc24ef377"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  // --- UI LOGIC (Menu Toggles) ---
  const menuBtn = document.getElementById('mobile-menu');
  const navList = document.getElementById('nav-list');
  const profileTrigger = document.getElementById('profileTrigger');
  const profileMenu = document.getElementById('profileMenu');

  // Mobile Menu Toggle
  menuBtn.addEventListener('click', () => {
    navList.classList.toggle('active');
    menuBtn.querySelector('i').className = navList.classList.contains('active') ? 'ri-close-line' : 'ri-menu-line';
  });

  // Profile Dropdown Toggle
  profileTrigger.addEventListener('click', (e) => {
    e.stopPropagation();
    profileMenu.classList.toggle('show');
  });

  document.addEventListener('click', () => {
    profileMenu.classList.remove('show');
  });

  // --- FIREBASE LOGIC ---
  const displayUserName = document.getElementById('displayUserName');
  const dropdownEmail = document.getElementById('dropdownEmail');
  const ordersList = document.getElementById('ordersList');
  const orderCount = document.getElementById('orderCount');

  onAuthStateChanged(auth, (user) => {
    if(user) {
      displayUserName.textContent = user.displayName || user.email.split('@')[0];
      dropdownEmail.textContent = user.email;

      const ordersRef = ref(db, 'orders');
      onValue(ordersRef, (snapshot) => {
        ordersList.innerHTML = '';
        let count = 0;
        
        snapshot.forEach((childSnapshot) => {
          const order = childSnapshot.val();
          if(order.email === user.email) {
            count++;
            const statusClass = `status-${(order.status || 'Pending').toLowerCase()}`;
            ordersList.innerHTML += `
              <div class="order-card">
                <div>
                  <h4 style="margin-bottom:4px; color: var(--dark)">${order.products ? order.products[0].name : 'Custom Order'}</h4>
                  <p style="font-size: 0.75rem; color: #94a3b8">Ref: ${childSnapshot.key.substring(0,8).toUpperCase()}</p>
                </div>
                <div style="text-align: right">
                  <p style="font-weight: 700; font-size: 0.9rem; margin-bottom: 5px;">${order.totalETB} ETB</p>
                  <span class="status-badge ${statusClass}">${order.status || 'Pending'}</span>
                </div>
              </div>
            `;
          }
        });

        orderCount.textContent = count;
        if(count === 0) ordersList.innerHTML = '<div class="stat-box" style="color:#94a3b8">No orders found. Start by placing one!</div>';
      });
    } else {
      window.location.href = "login.html";
    }
  });

  document.getElementById("logoutLink").onclick = (e) => {
    e.preventDefault();
    signOut(auth).then(() => window.location.href = "login.html");
  };
</script>

</body>
</html>